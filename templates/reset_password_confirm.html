{% extends "base.html" %}

{% block title %}Set New Password - STEM Academic Resource Platform{% endblock %}

{% block extra_css %}
<style>
    .reset-section {
        background: linear-gradient(135deg, var(--color-neutral-light) 0%, #fff 100%);
        min-height: 100vh;
        position: relative;
        overflow: hidden;
    }
    
    .reset-section .blob {
        position: absolute;
        border-radius: 50%;
        mix-blend-mode: multiply;
        filter: blur(3rem);
        opacity: 0.2;
        pointer-events: none;
    }
    
    .reset-section .blob-1 {
        top: 10%;
        right: 10%;
        width: 15rem;
        height: 15rem;
        background-color: #10B981;
        animation: blob 8s infinite;
    }
    
    .reset-section .blob-2 {
        bottom: 20%;
        left: 10%;
        width: 12rem;
        height: 12rem;
        background-color: #059669;
        animation: blob 8s infinite 2s;
    }
    
    @keyframes blob {
        0%, 100% { transform: translate(0, 0) scale(1); }
        33% { transform: translate(20px, -30px) scale(1.1); }
        66% { transform: translate(-15px, 15px) scale(0.9); }
    }
    
    .reset-card {
        background: rgba(255, 255, 255, 0.95);
        backdrop-filter: blur(20px);
        border: 1px solid rgba(16, 185, 129, 0.1);
        border-radius: 2rem;
        box-shadow: 0 20px 60px rgba(16, 185, 129, 0.1);
        overflow: hidden;
    }
    
    .reset-header {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        color: white;
        padding: 2.5rem 2rem 2rem;
        text-align: center;
        position: relative;
    }
    
    .form-floating .form-control {
        border: 2px solid rgba(16, 185, 129, 0.1);
        border-radius: 1rem;
        padding: 1rem 1.25rem;
        font-size: 1rem;
        background: rgba(255, 255, 255, 0.8);
        transition: all 0.3s ease;
        margin-bottom: 1.5rem;
    }
    
    .form-floating .form-control:focus {
        border-color: #10B981;
        box-shadow: 0 0 0 0.2rem rgba(16, 185, 129, 0.25);
        background: rgba(255, 255, 255, 0.95);
    }
    
    .btn-primary {
        background: linear-gradient(135deg, #10B981 0%, #059669 100%);
        border: none;
        border-radius: 1rem;
        padding: 0.75rem 1.5rem;
        font-weight: 600;
        transition: all 0.3s ease;
    }
    
    .btn-primary:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 25px rgba(16, 185, 129, 0.3);
    }
</style>
{% endblock %}

{% block content %}
<section class="reset-section d-flex align-items-center">
    <div class="blob blob-1"></div>
    <div class="blob blob-2"></div>
    
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-lg-5 col-md-7">
                <div class="reset-card">
                    <div class="reset-header">
                        <i class="fa-solid fa-shield-check brand-icon" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.9;"></i>
                        <h1 class="welcome-text" style="font-size: 1.75rem; font-weight: bold; margin-bottom: 0.5rem;">Set New Password</h1>
                        <p class="welcome-subtitle mb-0" style="opacity: 0.9; font-size: 1rem;">Choose a strong password for your account</p>
                    </div>
                    
                    <div class="p-4 p-md-5">
                        <form method="POST">
                            <div class="form-floating">
                                <input type="password" class="form-control" id="password" name="password" 
                                       required placeholder="New Password" minlength="6">
                                <label for="password">
                                    <i class="fa-solid fa-lock me-2"></i>New Password
                                </label>
                                <div class="form-text">At least 6 characters</div>
                            </div>
                            
                            <div class="form-floating">
                                <input type="password" class="form-control" id="confirm_password" name="confirm_password" 
                                       required placeholder="Confirm New Password">
                                <label for="confirm_password">
                                    <i class="fa-solid fa-lock me-2"></i>Confirm New Password
                                </label>
                            </div>
                            
                            <div class="d-grid mb-4">
                                <button type="submit" class="btn btn-primary btn-lg">
                                    <i class="fa-solid fa-check me-2"></i>Update Password
                                </button>
                            </div>
                        </form>
                        
                        <div class="text-center pt-3" style="border-top: 1px solid rgba(16, 185, 129, 0.1);">
                            <p class="text-muted mb-0">
                                Return to
                                <a href="{{ url_for('login') }}" class="fw-bold text-decoration-none" style="color: #10B981;">
                                    <i class="fa-solid fa-sign-in-alt me-1"></i>Sign In
                                </a>
                            </p>
                        </div>
                    </div>
                </div>
                
                <div class="text-center mt-4">
                    <div class="bg-white rounded-3 p-3 shadow-sm" style="border: 1px solid rgba(16, 185, 129, 0.1);">
                        <p class="text-muted small mb-0">
                            <i class="fa-solid fa-info-circle me-2" style="color: #10B981;"></i>
                            Your password will be updated immediately after submission
                        </p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const form = document.querySelector('form');
        const passwordInput = document.getElementById('password');
        const confirmPasswordInput = document.getElementById('confirm_password');
        
        setTimeout(() => {
            passwordInput.focus();
        }, 500);
        
        // Password confirmation validation
        confirmPasswordInput.addEventListener('input', function() {
            if (this.value && this.value !== passwordInput.value) {
                this.classList.add('is-invalid');
                this.setCustomValidity('Passwords do not match');
            } else {
                this.classList.remove('is-invalid');
                this.setCustomValidity('');
            }
        });
        
        passwordInput.addEventListener('input', function() {
            if (confirmPasswordInput.value) {
                confirmPasswordInput.dispatchEvent(new Event('input'));
            }
        });
        
        form.addEventListener('submit', function(e) {
            const submitBtn = form.querySelector('button[type="submit"]');
            const originalText = submitBtn.innerHTML;
            
            submitBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin me-2"></i>Updating...';
            submitBtn.disabled = true;
            
            setTimeout(() => {
                if (submitBtn.disabled) {
                    submitBtn.innerHTML = originalText;
                    submitBtn.disabled = false;
                }
            }, 5000);
        });
    });
</script>
{% endblock %}